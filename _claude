#compdef claude

# Zsh completion script for Claude Code CLI

_claude() {
    local curcontext="$curcontext" state line
    typeset -A opt_args

    local -a commands
    commands=(
        'mcp:Configure and manage MCP servers'
        'plugin:Manage Claude Code plugins'
        'migrate-installer:Migrate from global npm installation to local installation'
        'setup-token:Set up a long-lived authentication token'
        'doctor:Check the health of your Claude Code auto-updater'
        'update:Check for updates and install if available'
        'install:Install Claude Code native build'
    )

    local -a main_options
    main_options=(
        '(-d --debug)'{-d,--debug}'[Enable debug mode with optional category filtering]'
        '--verbose[Override verbose mode setting from config]'
        '(-p --print)'{-p,--print}'[Print response and exit (useful for pipes)]'
        '--output-format[Output format]:format:(text json stream-json)'
        '--json-schema[JSON Schema for structured output validation]:schema:'
        '--include-partial-messages[Include partial message chunks as they arrive]'
        '--input-format[Input format]:format:(text stream-json)'
        '--dangerously-skip-permissions[Bypass all permission checks]'
        '--allow-dangerously-skip-permissions[Enable bypassing permission checks as an option]'
        '--replay-user-messages[Re-emit user messages from stdin back on stdout]'
        '--allowedTools[Comma or space-separated list of tool names to allow]:tools:'
        '--allowed-tools[Comma or space-separated list of tool names to allow]:tools:'
        '--tools[Specify the list of available tools]:tools:'
        '--disallowedTools[Comma or space-separated list of tool names to deny]:tools:'
        '--disallowed-tools[Comma or space-separated list of tool names to deny]:tools:'
        '--mcp-config[Load MCP servers from JSON files or strings]:configs:_files'
        '--system-prompt[System prompt to use for the session]:prompt:'
        '--append-system-prompt[Append a system prompt to the default]:prompt:'
        '--permission-mode[Permission mode to use]:mode:(acceptEdits bypassPermissions default dontAsk plan)'
        '(-c --continue)'{-c,--continue}'[Continue the most recent conversation]'
        '(-r --resume)'{-r,--resume}'[Resume a conversation]:sessionId:'
        '--fork-session[When resuming, create a new session ID]'
        '--model[Model for the current session]:model:(sonnet opus haiku claude-sonnet-4-5-20250929 claude-opus-4-5-20251101)'
        '--fallback-model[Enable automatic fallback to specified model]:model:(sonnet opus haiku)'
        '--settings[Path to a settings JSON file or JSON string]:file:_files'
        '--add-dir[Additional directories to allow tool access to]:directories:_files -/'
        '--ide[Automatically connect to IDE on startup]'
        '--strict-mcp-config[Only use MCP servers from --mcp-config]'
        '--session-id[Use a specific session ID for the conversation]:uuid:'
        '--agents[JSON object defining custom agents]:json:'
        '--setting-sources[Comma-separated list of setting sources to load]:sources:'
        '--plugin-dir[Load plugins from directories]:paths:_files -/'
        '(-v --version)'{-v,--version}'[Output the version number]'
        '(-h --help)'{-h,--help}'[Display help for command]'
    )

    _arguments -C \
        $main_options \
        '1: :->command_or_prompt' \
        '*::arg:->args'

    case $state in
        command_or_prompt)
            _describe -t commands 'claude commands' commands
            ;;
        args)
            case $line[1] in
                mcp)
                    _arguments \
                        '1:mcp subcommand:(add remove list serve)'
                    ;;
                plugin)
                    _arguments \
                        '1:plugin subcommand:(add remove list)'
                    ;;
                install)
                    _arguments \
                        '1:target:(stable latest)'
                    ;;
                *)
                    _files
                    ;;
            esac
            ;;
    esac
}

_claude "$@"
